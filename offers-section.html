 <!-- Toggle Buttons -->
   <h4 class = "flimBitSectionHead"> Offers  </h4>

  <div class="tab-toggle">
    <button class="tab-btn active" onclick="showSection('category')">üìÇ Offer Type Category</button>
    <button class="tab-btn" onclick="showSection('type')">üè∑Ô∏è Offer Types</button>
	    <button class="tab-btn" onclick="showSection('offerMovie')">üè∑Ô∏è Movie Offer</button>

	
  </div>
  <!-- Section 1: Offer Type Category -->
  <div id="offerTypeCategorySection" class="flimBitMainDiv">
    <div class="">
	<div class="divPart" style="text-align:right">
      <button class="btn" onclick="openOfferTypeCategoryModal()">+ Add Category</button>
    </div>
	</div>
	<div class = "divPart">
    <table id="offerTypeCategoryTable">
      
    </table>
	</div>
  </div>

  <!-- Section 2: Offer Type -->
  <div id="offerTypeSection" class="flimBitMainDiv" style="display: none;">
	<div class="divPart" style="text-align:right">
      <button class="btn" onclick="openOfferTypeModal()">+ Add Offer Type</button>
    </div>
		<div class = "divPart">

    <table id="offerTypeTable">
     
    </table>
	</div>
  </div>
  
  
  
  
   <div id="offerMovieSection" style="display: none;" class="flimBitMainDiv" >

  <!-- üîπ Filter Section: Language & Movie -->
<div class="filter-bar divPart" style="display: flex; flex-wrap: wrap; gap: 2rem; align-items: center; margin-bottom: 1rem;">

  <div style="display: flex; flex-direction: column;">
    <label for="languageSelect" style="font-weight: bold;">üåê Language:</label>
    <select id="languageSelect" class="form-control" style="padding: 6px 12px; border-radius: 6px; min-width: 200px;" onchange = "onLanguageChange()">
     
    </select>
  </div>
  



  <div style="display: flex; flex-direction: column;">
    <label for="movieSelect" style="font-weight: bold;">üé¨ Movie:</label>
    <select id="movieSelect" class="form-control" style="padding: 6px 12px; border-radius: 6px; min-width: 220px;" onchange = "onMovieChange()">
      
    </select>
  </div>
  </div>



  <div id="dynamicOfferContent" class="divPart">

  <!-- üîπ Movie Information -->
 <div class="card">

</div>


  <!-- üîπ Share Type Sections -->
  <div id="shareTypeOfferContainer">

   
  
  </div> <!-- /#shareTypeOfferContainer -->
</div>
</div> <!-- /#offerMovieSection -->


  <!-- Offer Type Category Modal -->
<!-- Offer Type Category Modal -->
<div id="offerTypeCategoryModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeOfferTypeCategoryModal()">&times;</span>
    <h3>Add Offer Type Category</h3>
    <div id="offerTypeCategoryForm" >
      <div class="form-group">
        <label for="categoryName">Category Name</label>
        <input type="text" id="categoryName" class="form-control" oninput="validateField('categoryName')" />
        <div class="error-message" id="error-categoryName"></div>
      </div>

      <div class="form-group">
        <label for="categoryDescription">Description</label>
        <textarea id="categoryDescription" class="form-control" rows="3" oninput="validateField('categoryDescription')"></textarea>
        <div class="error-message" id="error-categoryDescription"></div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" onclick="validateOfferTypeCategoryForm()">Save</button>
        <button type="button" class="btn btn-secondary" onclick="closeOfferTypeCategoryModal()">Cancel</button>
      </div>
    </div>
  </div>
</div>

  <!-- Offer Type Modal -->
 <!-- Offer Type Modal -->
<div id="offerTypeModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeOfferTypeModal()">&times;</span>
    <h3>Add Offer Type</h3>
    <div id="offerTypeForm" >
      
      <div class="form-group">
        <label for="offerName">Offer Name</label>
        <input type="text" id="offerName" class="form-control" oninput="validateField('offerName')" />
        <div class="error-message" id="error-offerName"></div>
      </div>

      <div class="form-group">
        <label for="offerTypeSelect">Offer Type Category</label>
        <select id="offerTypeSelect" class="form-control" onchange="validateField('offerTypeSelect')">
          <option value="">-- Select Category --</option>
          <option value="1">FLAT</option>
          <option value="2">BONUS</option>
        </select>
        <div class="error-message" id="error-offerTypeSelect"></div>
      </div>

      <div class="form-group">
        <label for="targetAudience">Target Audience</label>
       <select id="targetAudience" name="targetAudience" class="form-control" onchange="validateField('targetAudience')"  style="min-width: 250px; padding: 6px 12px; border-radius: 6px;">
  <option value="">-- Please Select --</option>
  <option value="ALL_USERS">All Users</option>
  <option value="NEW_USERS">New Users</option>
  <option value="RETURNING_USERS">Returning Users</option>
  <option value="PREMIUM_SUBSCRIBERS">Premium Subscribers</option>
  <option value="FIRST_TIME_INVESTORS">First-Time Investors</option>
  <option value="HIGH_INVESTORS">High Investors</option>
  <option value="LANGUAGE_SPECIFIC">Language-Specific</option>
  <option value="LOCATION_BASED">Location-Based</option>
  <option value="REFERRAL_USERS">Referral Users</option>
  <option value="PROMO_CODE_USERS">Promo Code Users</option>
  <option value="LIMITED_GROUP">Limited Group</option>
</select>

	  <div class="error-message" id="error-targetAudience"></div>
      </div>

      <div class="form-group">
        <label for="statusSelect">Status</label>
        <select id="statusSelect" class="form-control" onchange="validateField('statusSelect')">
          <option value="">-- Select Status --</option>
          <option value="Active" selected>Active</option>
          <option value="Inactive">Inactive</option>
        </select>
        <div class="error-message" id="error-statusSelect"></div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" onclick=" validateOfferForm()">Save</button>
        <button type="button" class="btn btn-secondary" onclick="closeOfferTypeModal()">Cancel</button>
      </div>
    </div>
  </div>
</div>


<div id="offerShareTypeMovieModal" class="modal">
  <div class="modal-content">
 	
	    <div class="movie-user-box divPart" >
 <h5 class="modal-title">Add Offers 	<br>  Movie Name : <span id="offerTitleMovieName" style="color:#ffe600"></span>   
 Offer Name : <span id="offerTitleShareName" style="color:#ffe600"></span> </h5>
 <button type="button" class = "action-button" onclick = "closeModal('offerShareTypeMovieModal')">
        <span>&times;</span>
      </button>   
 


  </div>
        <input type="hidden" id="movieIdInput" />
        <input type="hidden" id="shareTypeIdInput" name="shareTypeHidden" />

      
    <div id="offerShareTypeMovieForm" class="divPart" >
	 <div style="font-size: 13px; background-color: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 5px;"> 
    üïí <span id="movshareStart"></span>
</div>

    <div class="row" >
      <!-- Offer -->
      <div class="form-group col-md-6">
        <label for="offerId">Offer</label>
        <select id="offerId" class="form-control" onchange="copySelectedNameToInputJQ(this,'targetId')"></select>
        <div class="error-message" id="error-offerId"></div>
      </div>

      <!-- Share Type -->
      <div class="form-group col-md-6">
        <label for="shareTypeId">targetAudience</label>
        
	    <input type="text" id="targetId" class="form-control" oninput="validateField('shareTypeId')" disabled/>

		<div class="error-message" id="error-shareTypeId"></div>
      </div>
	  
	 </div> 
     
	     <div class="row" >

      <!-- Movie -->
      <div class="form-group col-md-6">
    <div class="form-check mb-2">
        <input type="checkbox" class="form-check-input" id="buyGetCheckbox" onchange="toggleBuyGetInputs(this)">
        <label class="form-check-label" for="buyGetCheckbox">Enable Buy & Get Offer</label>
    </div>

    <div id="buyGetContainer" class="input-group mt-2" style="display: none;">
        <input type="number" id="buyQty" class="form-control" placeholder="Buy Quantity">
        <input type="number" id="getQty" class="form-control ml-2" placeholder="Get Quantity">
    </div>

    <div class="error-message" id="error-buyGet"></div>
</div>
	  <!-- Max Users -->
      <div class="form-group col-md-6">
        <label for="maxUsers">Max Users <span style="color: #007bff; font-size: 0.9em;">(-1 for unlimited)</span></label>
        <input type="number" id="maxUsers" class="form-control" />
      </div> 
	  
	  
     </div>
	 
	 
	 
   	     <div class="row" >
	 
      <!-- Valid Dates -->
      <div class="form-group col-md-6">
        <label for="validFrom">Valid From</label>
        <input type="datetime-local" id="validFrom" class="form-control" oninput="validateField('validFrom')" />
        <div class="error-message" id="error-validFrom"></div>
      </div>

      <div class="form-group col-md-6">
        <label for="validTo">Valid To</label>
        <input type="datetime-local" id="validTo" class="form-control" oninput="validateField('validTo')" />
        <div class="error-message" id="error-validTo"></div>
      </div>
     </div>
     
   	     <div class="row" >

      <!-- Discount -->
      <div class="form-group col-md-6">
        <label for="discountAmount">Discount Amount</label>
        <input type="number" step="0.01" id="discountAmount" class="form-control" />
      </div>

      <!-- Wallet Credit -->
      <div class="form-group col-md-6">
        <label for="walletCreditAmount">Wallet Credit Amount</label>
        <input type="number" step="0.01" id="walletCreditAmount" class="form-control" />
      </div>
    </div>

   	     <div class="row" >

      <!-- Checkboxes -->
      <div class="form-group form-group col-md-6">
	    <label><input type="checkbox" id="noPlatFormCommission" /> No Platform Commission</label>

        <label style="margin-right:5%;"><input type="checkbox" id="noProfitCommission" /> No Profit Commission</label>
     
        <label><input type="checkbox" id="promoCodeRequired" /> Promo Code Required</label>

	 </div>

      <!-- Status -->
      <div class="form-group form-group col-md-6">
        <label for="status">Status</label>
        <select id="status" class="form-control" onchange="validateField('status')">
          <option value="active">Active</option>
          <option value="unactive">Unactive</option>
        </select>
        <div class="error-message" id="error-status"></div>
      </div>
	  
	</div>  

      
    </div>
	
	<div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="saveOfferShareTypeMovie()">Save</button>
        <button type="button" class="btn btn-secondary" onclick="closeOfferShareTypeMovieModal()">Cancel</button>
      </div>
	
	
  </div>
</div>

  
    <style>
	input.valid, textarea.valid, select.valid {
  border-color: green;
  background-image: url('data:image/svg+xml;utf8,<svg width="16" height="16" fill="green" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M13.485 1.929l-8.486 8.485-3.536-3.536-1.414 1.414 4.95 4.95 9.9-9.9z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 16px;
}

input.invalid, textarea.invalid, select.invalid {
  border-color: red;
}

.main-content
{

 margin-top:2%;

}


    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }

    .tab-toggle {
      display: flex;
      gap: 10px;
    }

   .tab-btn {
      padding: 7px 12px;
      cursor: pointer;
      font-weight: bold;
      color: #555;
      border-bottom: 3px solid transparent;
	      border: 0px;
    background-color: transparent;	
    }

    .tab-btn.active {
      color: #FFD700;
    }

    .section-container {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      background: #fff;
      margin-bottom: 20px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding: 10px 0;
      border-bottom: 2px solid #ddd;
    }

    .section-header h4 {
      font-size: 18px;
      font-weight: 600;
      color: #333;
	  display: flex;
  justify-content: flex-end;
  align-items: center;
    }

    .add-btn {
      padding: 6px 12px;
      background-color: #ffcc00;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .add-btn:hover {
      background-color: #f2b900;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    table th, table td {
      padding: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
    }

    table th {
      background-color: #f9f9f9;
      font-weight: 600;
      color: #333;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 10%;
      left: 20%;
      width: 70%;
      background-color: transparent;
      z-index: 1000;
    }

    

    .close {
      position: absolute;
      top: -10px;
      right: 10px;
      font-size: 22px;
      cursor: pointer;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-control {
      width: 100%;
      padding: 6px 10px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .form-actions {
      display: flex;
      gap: 12px;
      margin-top: 15px;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }

    .btn-primary {
      background-color: #ffcc00;
      color: black;
    }

    .btn-primary:hover {
      background-color: #f2b900;
    }

    .btn-secondary {
      background-color: #eee;
      color: #333;
    }

    .btn-secondary:hover {
      background-color: #ddd;
    }
	/* Green check icon for valid field */
input.valid, textarea.valid {
  border-color: green;
  background-image: url('data:image/svg+xml;utf8,<svg width="16" height="16" fill="green" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M13.485 1.929l-8.486 8.485-3.536-3.536-1.414 1.414 4.95 4.95 9.9-9.9z"/></svg>');
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 16px;
}

/* Red border for invalid field */
input.invalid, textarea.invalid {
  border-color: red;
}

.section-container {
  padding: 20px;
  background: #fffbe6;
  border-radius: 12px;
}

.filter-bar {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
  align-items: center;
}

.card {
  background: #f5f4ef;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 10px;
}

.share-section {
  background: #fffdf3;
  padding: 15px;
  margin-bottom: 30px;
  border: 1px solid #fcd34d;
  border-radius: 8px;
}

.share-header {
  font-weight: bold;
  margin-bottom: 10px;
  font-size: 1.1em;
}

.offer-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 10px;
}

.offer-table th,
.offer-table td {
  border: 1px solid #facc15;
  padding: 8px;
  text-align: center;
}

.add-offer-btn {
  background: #ffd700;
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
.card p {
  margin: 6px 0;
}
/* Yellow checkbox design */
.custom-checkbox {
  appearance: none;
  width: 15px;
  height: 15px;
  border: 2px solid #ffc107;
  border-radius: 4px;
  background-color: #fffbe6;
  position: relative;
  cursor: default;
  box-shadow: 0 0 3px rgba(255, 193, 7, 0.5);
  transition: all 0.2s ease;
  vertical-align: middle;
  padding: 0;
}

.custom-checkbox:checked {
  background-color: #ffe600;
  border-color: #ffca2c;
  box-shadow: 0 0 6px rgba(255, 193, 7, 0.8);
}

.custom-checkbox:checked::after {
  content: '‚úî';
  color: #212529;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -48%);
  font-size: 10px;
  font-weight: bold;
  line-height: 1;
}

.status-badge {
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  text-transform: capitalize;
  display: inline-block;
  min-width: 70px;
  text-align: center;
  box-shadow: 0 0 4px rgba(0,0,0,0.1);
}

.status-badge.active {
  background-color: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.status-badge.inactive {
  background-color: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}
.movie-status {
  font-weight: bold;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 13px;
}

.movie-status.active {
  background-color: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
  box-shadow: 0 0 5px rgba(72, 180, 97, 0.4);
}


  </style>
  
  <script>
  isEditOfferType = false;
  isOffersScrSelectBox = false;
  	 isOfferEdit = false;
var isUpdateMovShareOffer = false;
var movShareOfferId = 0;	 
	 
	 var shareStartTime;
	 var shareEndTime;


   function toggleBuyGetInputs(checkbox) {
    if ($(checkbox).is(':checked')) {
        $("#buyGetContainer").show();
        $("#buyQty, #getQty").prop("disabled", false);
    } else {
        $("#buyGetContainer").hide();
        $("#buyQty, #getQty").prop("disabled", true).val("");
    }
}

   function openOfferMovieModal(movId,movName,shareId,ShareName,startDate,endDate)
   {
   isUpdateMovShareOffer = false;
   $("#offerShareTypeMovieModal").show();
   $("#movieId").val(movName);
   console.log("coco");
   $("#offerTitleMovieName").text(movName);
   $("#shareTypeId").val(ShareName);
   $("#offerTitleShareName").text(ShareName);
   $("#movieIdInput").val(movId);
   $("#shareTypeIdInput").val(shareId);
   $('#movshareStart').text(startDate +" ‚Üí " +endDate);
   
   shareStartTime = startDate;
   shareEndTime   = endDate;
   

   	clearAllFormInsideDiv("#offerShareTypeMovieForm");
       toggleBuyGetInputs(document.getElementById("buyGetCheckbox"));

   

   }
  function loadOfferSection()
  {
     drawDataTableForOfferType();
  
  }
  
  function drawDataTableForOfferType()
  {
   $('#offerTypeCategoryTable').DataTable({
   destroy: true,
    processing: true,
    serverSide: true,
    lengthChange: false,
    pageLength: 10,
  ajax: {
    url: dataTableOfferTypeUrl,
    type: 'POST',
    headers: getAppHeaer(),
	data: function (d) {
        return {
          draw: d.draw,
          start: d.start,
          length: d.length,
          searchText: d.search.value,
          sortColumn: d.columns[d.order[0].column].data,
          sortOrder: d.order[0].dir
        };
      },
	  dataFilter: function (response) {
        const fullResponse = JSON.parse(response);
        const obj = fullResponse.result;
		total = obj.recordsTotal ?? 0
       $("#rewardCount").text("(" +total + ")");
	   if(!isOffersScrSelectBox)
	   {
	     populateSelectBox("offerTypeSelect",obj.data,"id","name");
        }
	   

      // Debug: make sure obj is valid
      return JSON.stringify({
        draw: obj.draw > 0 ? obj.draw : 1,
        recordsTotal: obj.recordsTotal ?? 0,
        recordsFiltered: obj.recordsFiltered ?? 0,
        data: obj.data ?? []
      });
      }

  },
  columns: [
    { data: 'id', title: 'ID' },
    { data: 'name', title: 'Offer Name' },
    { data: 'description', title: 'Description' },
    {
      data: 'createdAt',
      title: 'Created At',
      render: function (data) {
        return new Date(data).toLocaleString();
      }
    },
    {
      data: null,
      title: 'Actions',
      orderable: false,
      render: function (row) {
        return `
          <button onclick="editOfferType(${row.id})">Edit</button>
          <button onclick="deleteOfferType(${row.id})">Delete</button>
        `;
      }
    }
  ]
});

  $('#offerTypeCategoryTable_filter input')
    .unbind()
    .bind('keyup', function (e) {
      if (e.key === 'Enter' || e.keyCode === 13) {
        $('#offerTypeCategoryTable').DataTable().search(this.value).draw();
      }
    });
  
  }
  
    function showSection(section) {
      // Toggle section
      document.getElementById("offerTypeCategorySection").style.display = section === 'category' ? 'block' : 'none';
      document.getElementById("offerTypeSection").style.display = section === 'type' ? 'block' : 'none';
	  document.getElementById("offerMovieSection").style.display = section === 'offerMovie' ? 'block' : 'none';


      // Toggle buttons
      const buttons = document.querySelectorAll(".tab-btn");
      buttons.forEach(btn => btn.classList.remove("active"));
      if (section === 'category') 
	  buttons[0].classList.add("active");
	  else if (section === 'type')
	  buttons[1].classList.add("active");
      else 
	  buttons[2].classList.add("active");
	  
	  if(section === "type")
	    loadOfferType();
      if(section === "offerMovie")
	    loadOfferMovie();	  
    }
	
	function onMovieChange() {
  var selectedMovieId = $('#movieSelect').val();

  
	sendAjaxRequest(readMovieOfferBymovIdUrl+selectedMovieId, "GET", getAppHeaer(), null,onMovieSelectCallBack );

  // You can now use the selectedLanguageId to load movies dynamically, etc.
}

var  onMovieSelectCallBack = function onMovieSelectCallBackFun(response)
{
console.log("comming onmvieSelct");
var data = readFinalResult(response);

   if(data != null)
   {
         console.log("offerMovie Rebi");
        renderOfferMovieSection(data);
   
   }


}



	
	function onLanguageChange() {
	$('#dynamicOfferContent').empty();

  var selectedLanguageId = $('#languageSelect').val();
  var selectedLanguageName = $('#languageSelect option:selected').text();
	sendAjaxRequest(readMovieBylangIdUrl+selectedLanguageId, "GET", getAppHeaer(), null,readMovieByLanCallBack );

  // You can now use the selectedLanguageId to load movies dynamically, etc.
}

var  readMovieByLanCallBack =	function readMovieByLanSection(response)
{
var data = readFinalResult(response);

   if(data != null)
   {
   	     populateSelectBox("movieSelect",data,"id","title");
         
         const $movieSelect = $('#movieSelect');

        // Only proceed if there's at least one real option
        if ($movieSelect.find('option').length > 1) {
          $movieSelect.prop('selectedIndex', 1).trigger('change');
         }
   
   }

}







	
	function loadOfferMovie()
	{
	   // sendAjaxRequest(readAllOfferUrl, "GET", getAppHeaer(), null,readAllOfferCallBack );
        
	  sendAjaxRequest(readMovLanguageUrl, "GET", getAppHeaer(), null,readAllOfferCallBack );
	
	}
var  readAllOfferCallBack =	function readAllOfferSection(response)
{
var data = readFinalResult(response);

   if(data != null)
   {
   	     populateSelectBox("languageSelect",data,"id","name");
		 
         sendAjaxRequest(readAllOfferUrl, "GET", getAppHeaer(), null,loadOfferSelectBox )
		 
		 
		 const $languageSelect = $('#languageSelect');

        // Only proceed if there's at least one real option
		console.log("1 am ");
				     $('#dynamicOfferContent').empty();

        if ($languageSelect.find('option').length > 1) {
          $languageSelect.prop('selectedIndex', 1).trigger('change');
         } 
		
 
   
   }

}


function copySelectedNameToInputJQ(selectElement, targetInputId) {
    // Use jQuery to get selected option
    var selectedName = $(selectElement).find(":selected").attr("name") || "";
    
    // Set value to input box using jQuery
    $("#" + targetInputId).val(selectedName);
}
var   loadOfferSelectBox = function readAllForOfferSelect(response)
{ 

 if(response.result != null)
   {
   	     populateSelectBox("offerId",response.result,"id","offerName",null,"targetAudience");
		 
		 
		 
         
         
   
   }
}	

function formatExpandRowOffer(rowData) {
  return `
    <div style="padding: 10px 20px; background-color: #f9f9f9; border-left: 4px solid #007bff;">
      
   <strong>Offer Type Description:</strong> ${formatNA(rowData.typeDescription)}&nbsp;&nbsp;

	<strong>updatedAt:</strong> ${formatDateTime(rowData.updatedAt)} &nbsp;&nbsp;

    </div>

	
	   
  `;
}
	
	function loadOfferType()
	{
	  
	 const table =  $('#offerTypeTable').DataTable({
   destroy: true,
    processing: true,
    serverSide: true,
    lengthChange: false,
    pageLength: 10,
  ajax: {
    url: dataTableOfferUrl,
    type: 'POST',
    headers: getAppHeaer(),
	data: function (d) {
        return {
          draw: d.draw,
          start: d.start,
          length: d.length,
          searchText: d.search.value,
          sortColumn: d.columns[d.order[0].column].data,
          sortOrder: d.order[0].dir
        };
      },
	  dataFilter: function (response) {
        const fullResponse = JSON.parse(response);
        const obj = fullResponse.result;
		total = obj.recordsTotal ?? 0
       $("#rewardCount").text("(" +total + ")");
	   

      // Debug: make sure obj is valid
      return JSON.stringify({
        draw: obj.draw > 0 ? obj.draw : 1,
        recordsTotal: obj.recordsTotal ?? 0,
        recordsFiltered: obj.recordsFiltered ?? 0,
        data: obj.data ?? []
      });
      }

  },
  columns:  [
     {
        className: 'dt-control',
        orderable: false,
        data: null,
        defaultContent: '',
        title: ''
      },
      { data: 'offerName', title: 'Offer Name' },
      {
        data: 'typeName',
        title: 'Offer Type',
        render: formatNA

      },
      { data: 'targetAudience',
       title: 'Target Audience',
               render: formatNA

      
      },
      { data: 'status', title: 'Status' , render: renderStatus},
      {
        data: 'createdAt',
        title: 'Created At',
        render: function (data) {
          return new Date(data).toLocaleString();
        }
      },
      {
        data: null,
        title: 'Actions',
        orderable: false,
        render: function (row) {
          return `
            <button onclick="editOffer(${row.id})">Edit</button>
            <button onclick="deleteOffer(${row.id})">Delete</button>
          `;
        }
      }
    ]
});
	    $('#offerTypeTable tbody').off('click', 'td.dt-control').on('click', 'td.dt-control', function () {
    const tr = $(this).closest('tr');
    const row = table.row(tr);

    if (row.child.isShown()) {
      row.child.hide();
      tr.removeClass('shown');
    } else {
      row.child(formatExpandRowOffer(row.data())).show();
      tr.addClass('shown');
    }
  });
  $('#offerTypeTable_filter input')
    .unbind()
    .bind('keyup', function (e) {
      if (e.key === 'Enter' || e.keyCode === 13) {
        $('#offerTypeCategoryTable').DataTable().search(this.value).draw();
      }
    });
  

  
	  
	}



    function openOfferTypeModal() {
	  isOfferEdit = false;
      document.getElementById("offerTypeModal").style.display = "block";
    }

    function closeOfferTypeModal() {
      document.getElementById("offerTypeModal").style.display = "none";
    }

    function openOfferTypeCategoryModal() {
	  isEditOfferType = false;
      document.getElementById("offerTypeCategoryModal").style.display = "block";
    }

    function closeOfferTypeCategoryModal() {
      document.getElementById("offerTypeCategoryModal").style.display = "none";
    }
	
	function validateField(fieldId) {
  const value = document.getElementById(fieldId).value.trim();
  const input = document.getElementById(fieldId);
  const errorDiv = document.getElementById("error-" + fieldId);

  if (!value) {
    input.classList.remove("valid");
    input.classList.add("invalid");
    errorDiv.textContent = "This field is required";
    return false;
  } else {
    input.classList.remove("invalid");
    input.classList.add("valid");
    errorDiv.textContent = "";
    return true;
  }
}
function editOfferType(id)
{
     isEditOfferType = true;
    sendAjaxRequest(readOfferTypeByIdUrl+id, "GET", getAppHeaer(), null,readEditOfferTypeCallBack );


}
var currentOfferTypeId = 0;
var readEditOfferTypeCallBack = function(response)
{
var data = readFinalResult(response);
		   if(data !=null)
		   {
                  $("#offerTypeCategoryModal").show();
				    currentOfferTypeId = data.id;
                    $("#categoryName").val(data.name);
					$("#categoryDescription").val(data.description);
			 
		   }
		   


}


function validateOfferTypeCategoryForm() {
  const isNameValid = validateField('categoryName');
  const isDescValid = validateField('categoryDescription');

  if (isNameValid && isDescValid) {
    // Do actual saving logic here (AJAX or form submit)
	
	var urlx = insertOfferTypeUrl;
  if(isEditOfferType)
  {
	 urlx = updateOfferTypeByIdUrl  + currentOfferTypeId;
  }
  
  const requestData = {
  name : $("#categoryName").val().trim(),
  description : $("#categoryDescription").val().trim()
 };
   
  // You can now send requestData via $.post or fetch here
    sendAjaxRequest(urlx, "POST", getAppHeaer(), requestData,saveOffertypeCallBack );
	
	
     // prevent actual form submit for demo
  }
}
var  saveOffertypeCallBack = function(response)
{
var data = readFinalResult(response);
		   if(data !=null)
		   {
                  closeOfferTypeCategoryModal();
              	 $('#offerTypeCategoryTable').DataTable().ajax.reload(null, false);

			 
		   }

}
function deleteOfferType(id)
{

const confirmDelete = confirm("Are you sure you want to delete this cast record?");
if (confirmDelete) {
   	 sendAjaxRequest(deleteOfferTypeByIdUrl+id, "GET", getAppHeaer(), null,saveOffertypeCallBack );
}



}

function validateField(fieldId) {
  const field = document.getElementById(fieldId);
  const value = field.value.trim();
  const errorDiv = document.getElementById("error-" + fieldId);

  if (!value) {
    field.classList.remove("valid");
    field.classList.add("invalid");
    errorDiv.textContent = "This field is required";
    return false;
  } else {
    field.classList.remove("invalid");
    field.classList.add("valid");
    errorDiv.textContent = "";
    return true;
  }
}
var currentOfferId = 0;
function validateOfferForm() {
  const isNameValid = validateField('offerName');
  const isTypeValid = validateField('offerTypeSelect');
  const isAudienceValid = validateField('targetAudience');
  const isStatusValid = validateField('statusSelect');

  if (isNameValid && isTypeValid && isAudienceValid && isStatusValid) {
    // Perform save logic here (AJAX or form handling)
    closeOfferTypeModal();
    // Prevent actual form submission for now
	
	var urlx = insertOfferUrl;
  if(isOfferEdit)
  {
	 urlx = updateOfferByIdUrl  + currentOfferId;
  }
  
  const requestData = {
  offerName : $("#offerName").val().trim(),
  offerType : $("#offerTypeSelect").val().trim(),
  targetAudience : $("#targetAudience").val().trim(),
  status  : $("#statusSelect").val().trim()
 };
   
  // You can now send requestData via $.post or fetch here
   sendAjaxRequest(urlx, "POST", getAppHeaer(), requestData,saveOfferCallBack );
  }
  else
{  
	alert("comming insert");

 } 
}

var  saveOfferCallBack  = function saveOfferMethord(response)
{
var data = readFinalResult(response);
		   if(data !=null)
		   {
                  closeOfferTypeCategoryModal();
				  
				  
              	 $('#offerTypeTable').DataTable().ajax.reload(null, false);

			 
		   }
}

function editOffer(id)
{
isOfferEdit = true;
   currentOfferId  = id;
    sendAjaxRequest(readOfferByIdUrl+id, "GET", getAppHeaer(), null,displayEditOfferCallBack );



}

function displayEditOfferCallBack(response)
{
var data = readFinalResult(response);
		   if(data !=null)
		   {
  
			  
  
  $("#offerTypeModal").show();
  
  $("#offerName").val(data.offerName);
  $("#offerTypeSelect").val(data.offerType);
  $("#targetAudience").val(data.targetAudience);
  $("#statusSelect").val(data.status);
  
  
		   }


}
function deleteOffer(id)
{

const confirmDelete = confirm("Are you sure you want to delete this offer record?");
if (confirmDelete) {
   	 sendAjaxRequest(deleteOfferByIdUrl+id, "GET", getAppHeaer(), null,saveOfferCallBack );
}

}

function validateBuyGetInputs() {
    let isValid = true;

    // Reset previous states
    $("#buyQty, #getQty").removeClass("is-invalid is-valid");
    $("#error-buyGet").text("");

    if ($("#buyGetCheckbox").is(":checked")) {
        const buyQty = parseInt($("#buyQty").val()) || 0;
        const getQty = parseInt($("#getQty").val()) || 0;

        if (buyQty <= 0 || getQty <= 0) {
            isValid = false;

            // Add invalid class to both fields
            $("#buyQty, #getQty").addClass("is-invalid");
            $("#error-buyGet").text("Both Buy and Get quantities must be greater than zero.");
        } else {
            // Add valid class to both fields
            $("#buyQty, #getQty").addClass("is-valid");
        }
    }

    return isValid;
}

function saveOfferShareTypeMovie() {
  // Validate required fields



  const isValid =
    validateField('offerId') &

    validateField('validFrom') &
    validateField('validTo') &
    validateBuyGetInputs() &
    validateField('status');

  if (!isValid) return;
  
  
const validFromDate = new Date($('#validFrom').val());
const validToDate = new Date($('#validTo').val());
const validToInput = document.getElementById('validTo');
const errorDiv = document.getElementById('error-validTo');


const ShareFromDate = new Date(shareStartTime);
const ShareEndDate = new Date(shareEndTime);

saveOfferShareTypeMovie

if (validToDate < validFromDate) {
  validToInput.classList.remove("valid");
  validToInput.classList.add("invalid");
  errorDiv.textContent = "'Valid To' cannot be earlier than 'Valid From'";
  return;
} 
else if (validFromDate < ShareFromDate || validToDate > ShareEndDate) {
  validToInput.classList.remove("valid");
  validToInput.classList.add("invalid");
  errorDiv.textContent = "'Start date and End Date' must be between the 'Share start date' and 'Share end date'";
  return;
}

else {
  validToInput.classList.remove("invalid");
  validToInput.classList.add("valid");
  errorDiv.textContent = "";
}



var urlx = insertMovieShareOfferUrl;
if(isUpdateMovShareOffer)
    urlx = updateMovieShareOfferUrl + movShareOfferId;


 isBuyGet = $('#buyGetCheckbox').is(':checked') || false;
  // Collect data
  const data = {
    offerId: parseInt($('#offerId').val(),10) ,
    shareTypeId: parseInt($('#shareTypeIdInput').val(),10) ,
    movieId: parseInt($('#movieIdInput').val(),10) ,
    validFrom: toSqlTimestampWithMillis($('#validFrom').val()) ,
    validTo: toSqlTimestampWithMillis($('#validTo').val()),
    maxUsers: parseInt($('#maxUsers').val() || '0',10),
    discountAmount: parseInt($('#discountAmount').val() || '0',10) ,
    walletCreditAmount: parseInt($('#walletCreditAmount').val() || '0',10) ,
    noProfitCommission: $('#noProfitCommission').is(':checked') || false,
	noPlatFormCommission: $('#noPlatFormCommission').is(':checked') || false,
    promoCodeRequired: $('#promoCodeRequired').is(':checked') || false,
    status: $('#status').val(),
    isBuyAndGet : isBuyGet,
    buyCount : isBuyGet ? (parseInt($("#buyQty").val()) || 0) : 0,
    freeCount : isBuyGet ? (parseInt($("#getQty").val()) || 0) : 0

  };
	    sendAjaxRequest(urlx, "POST", getAppHeaer(), data,saveMovieShareOffer );



  // Optional: Handle Edit Mode

}
var saveMovieShareOffer = function saveMovieShareOfferFun(response)
{
var data = readFinalResult(response);
		   if(data !=null)
		   {
              $('#movieSelect').trigger('change');
              $("#offerShareTypeMovieModal").hide();

  
		   }




}

function closeOfferShareTypeMovieModal() {
  $('#offerShareTypeMovieModal').hide();
}
function renderOfferMovieSection(data) {

  const movie = data;
  const shareTypes = data.shareTypes;

  // Clear container
  $('#dynamicOfferContent').empty();

  // üîπ Movie Info Card
  const $movieCard = $(`
    <div class="card">
      <h3>üéûÔ∏è Movie: ${movie.movieTitle}</h3>
      <div style="display: flex; flex-wrap: wrap; justify-content: space-between;">
        <div style="width: 48%; margin-bottom: 10px;">
          <p><b>Language:</b> ${movie.language}</p>
          <p><b>Budget:</b> ‚Çπ${movie.budget}</p>
		  <p><b>Invested:</b> ‚Çπ${movie.totalInvestedAmount}</p>
          <p><b>Type:</b> ${movie.movieType}</p>
<p>
  <b>Status:</b>
  <span class="movie-status ${movie.status.toLowerCase()}">
    ${movie.status.charAt(0).toUpperCase() + movie.status.slice(1)}
  </span>
</p>


        </div>
        <div style="width: 48%; margin-bottom: 10px;">
		<p><b>Start Date:</b> ${movie.startDate ? movie.startDate : 'N/A'}</p>

          <p><b>Trailer Date:</b> ${movie.trailerDate}</p>
		  <p><b>Release Date:</b> ${movie.releaseDate ? movie.releaseDate : 'N/A'}</p>

        </div>
      </div>
    </div>
  `);

  $('#dynamicOfferContent').append($movieCard);

  // üîπ Share Types Container
  const $shareContainer = $('<div id="shareTypeOfferContainer"></div>');

  shareTypes.forEach(st => {
    const $shareSection = $('<div class="divPart"></div>');
    const $header = $(`
<div class="share-header" style="display: flex; justify-content: space-between; align-items: center;">
  <div>
    üî∂ Share Type: ${st.shareTypeName} (‚Çπ${st.pricePerShare}/share, ${st.totalShares} total)
  </div>
  <div style="font-size: 13px; background-color: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 5px;">
    üïí ${st.shareStartDate} ‚Üí ${st.shareEndDate}
  </div>
</div>    `);

    // Offer Table
    const $table = $(`
      <table class="offer-table">
        <thead>
          <tr>
            <th>Offer Title</th>
            <th>Offer Type</th>
            <th>D/W/NPFC/NPC/P </th>
            <th>Buy/Get
            <th>Start</th>
            <th>End</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    `);

    const $tbody = $table.find('tbody');
    if (st.offers && st.offers.length > 0) {
      st.offers.forEach(offer => {
        const $row = $(`
          <tr>
            <td>${offer.offerName} :  ${offer.targetAudience}  : ${offer.maxUsers} </td>
            <td>${offer.offerTypeName}</td>
<td>
   ${offer.discountAmount ?? 0}% / ‚Çπ${offer.walletCreditAmount ?? 0}
   /<input type="checkbox" class="custom-checkbox" disabled ${offer.noPlatFormCommission ? 'checked' : ''}>
   /    <input type="checkbox" class="custom-checkbox" disabled ${offer.noProfitCommission ? 'checked' : ''}>
   /   <input type="checkbox" class="custom-checkbox" disabled ${offer.promoCodeRequired ? 'checked' : ''}>
</td>        
<td> ${offer.buyQuantity} / ${offer.freeQuantity} </td>
<td>${offer.validFrom}</td>
            <td>${offer.validTo}</td>
<td>
  <span class="status-badge ${offer.offerStatus === 'active' ? 'active' : 'inactive'}">
    ${offer.offerStatus.charAt(0).toUpperCase() + offer.offerStatus.slice(1)}
  </span>
</td>           


 <td>
<button onclick="editMovShareOfferMethod(
          '${movie.movieId}',
    '${movie.movieTitle}',
    '${st.shareTypeId}',
    '${st.shareTypeName}',

          ${offer.movShareOfferId},
		  '${st.shareStartDate}',
		  '${st.shareEndDate}')">‚úèÔ∏è</button>
			  <button  onclick="deleteMovShareOffer(${offer.movShareOfferId})">üóëÔ∏è</button>
            </td>
          </tr>
        `);
        $tbody.append($row);
      });
    } else {
      $tbody.append(`<tr><td colspan="7">No offers yet.</td></tr>`);
    }

    const $addBtn = $(`
  <button class="add-offer-btn" onclick="openOfferMovieModal(
    '${movie.movieId}',
    '${movie.movieTitle}',
    '${st.shareTypeId}',
    '${st.shareTypeName}',
	'${st.shareStartDate}', 
	'${st.shareEndDate}'
  )">
    + Add Offer for ${st.shareTypeName}
  </button>
`);
    // Append everything
    $shareSection.append($header, $table, $addBtn);
    $shareContainer.append($shareSection);
  });

  $('#dynamicOfferContent').append($shareContainer);
}
function editMovShareOfferMethod(movId,movName,shareId,ShareName,movShareOffId , startDate,endDate)
{
    isUpdateMovShareOffer = true;
	movShareOfferId = movShareOffId;

   isUpdateMovShareOffer  = true;
   $("#movieId").val(movName);
   $("#shareTypeId").val(ShareName);
   $("#movieIdInput").val(movId);
   $("#shareTypeIdInput").val(shareId);
   $('#movshareStart').text(startDate +" ‚Üí " +endDate);
     	    sendAjaxRequest(readMovieShareOfferByOfferIdUrl+movShareOffId, "GET",getAppHeaer(), null,movShareOfferCallBack );


}

var movShareOfferCallBack = function movShareOfferCallBackFn(response)
{
          
           var data = readFinalResult(response);
		   console.log(data);
		   if(data !=null)
		   {
		   
    $('#offerId').val(data.offerId);   
    $("#offerId").trigger("change");
 
   $('#validFrom').val(formatDateTimeFromTimeStamp(data.validFrom)); 
    $('#validTo').val(formatDateTimeFromTimeStamp(data.validTo));

    $('#maxUsers').val(data.maxUsers);
    $('#discountAmount').val(data.discountAmount) 
    $('#walletCreditAmount').val(data.walletCreditAmount == null ? 0 : data.walletCreditAmount) 
    $('#noProfitCommission').prop('checked', data.noProfitCommission);
    $('#promoCodeRequired').prop('checked', data.promoCodeRequired);
    $('#status').val(data.status);
  
    $("#buyGetCheckbox").prop('checked', data.buyOneGetOne);
    
    $('#buyQty').val(data.buyQuantity);
       $('#getQty').val(data.getQuantity);

       toggleBuyGetInputs(document.getElementById("buyGetCheckbox"));

    
    
  // $('#promoCodeRequired').is(':checked') || false,
 //  
 
			    $("#offerShareTypeMovieModal").show();


 
  
  
		   }


}

function deleteMovShareOffer(id)
{

const confirmDelete = confirm("Are you sure you want to delete this offer record?");
if (confirmDelete) {
   	 sendAjaxRequest(deleteMovieShareOfferUrl+id, "GET", getAppHeaer(), null,saveMovieShareOffer );
}

}

  </script>
